<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Editar Perfil</title>
</head>


<body class="bg-light text-center">

    <%- include('partials/navbar') %>


        <div class="container d-flex justify-content-center align-items-center" style="min-height: 80vh;">
            <div class="card p-4 shadow" style="width: 100%; max-width: 400px;">
                <form action='/editar-foto/<%= usuario.id %>/<%= usuarios[0].imagem %>' method="POST"
                    enctype="multipart/form-data">



                    <% if (typeof error !=='undefined' && error) { %>
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <strong>
                                <%= error %>
                            </strong>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        <% } %>


                            <div class="mb-3">

                                <input type="hidden" class="form-control" value="<%= usuario.id %>">

                            </div>

                            <div class="mb-3" id="add-imagem">
                                <% if (usuarios && usuarios.length && usuarios[0].imagem) { %>
                                    <img src="/imagem/<%= usuarios[0].imagem %>" alt="Foto de perfil"
                                        class="img-profile" id="perfil" loading="lazy">
                                    <% } else { %>
                                        <img src="/imagem/user.png" alt="Foto padrÃ£o" class="img-profile" loading="lazy"
                                            id="perfil">
                                        <% } %>

                                            <input type="file" onchange="atualizarPerfil()" class="form-control"
                                                id="file" name="imagemNova">
                            </div>


                            <div class="mb-3" id="add-imagem">

                                <p>
                                    <%= usuario.nome %>
                                </p>

                            </div>
                            <button type="submit" class="btn btn-primary w-100">Confirmar</button>
                </form>
                <br>
                <a href="<%= voltar %>" class="btn btn-danger w-100">Voltar</a>
            </div>
        </div>
        <%- include('partials/footer') %>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
                crossorigin="anonymous"></script>

            <script>
                function atualizarPerfil() {

                    let perfil = document.getElementById('perfil');
                    let file = document.getElementById('file');

                    if (file.files && file.files[0]) {
                        const imgURL = URL.createObjectURL(file.files[0]);
                        perfil.src = imgURL;
                    } else {
                        perfil.src = '/imagem/user.png';
                    }
                }
            </script>
</body>

</html>